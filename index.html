<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MMA Official App</title>
<style>
  :root{
    --bg:#0c1a2a;        /* page bg */
    --card:#0f2238;      /* card bg */
    --text:#e6f0ff;      /* primary text */
    --muted:#9cb6d1;     /* secondary text */
    --brand:#11b7ff;     /* brand cyan */
    --brand-2:#6be7ff;   /* brand light */
    --danger:#ff5d6c;    /* red */
    --ok:#2ecc71;        /* green */
    --chip:#152a44;      /* chip bg */
    --chip-text:#bcd0ea;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    color:var(--text);
    background: radial-gradient(1200px 600px at 30% -10%, #0c2b4c 5%, transparent 60%),
                radial-gradient(800px 400px at 90% 0%, #0a2240 5%, transparent 55%),
                var(--bg);
    min-height:100vh;
  }
  .container{
    max-width:1100px;
    margin:42px auto;
    padding:0 16px;
  }
  .card{
    background: linear-gradient(180deg, rgba(18,37,62,.75), rgba(12,31,53,.75));
    border:1px solid rgba(255,255,255,.06);
    border-radius:14px;
    box-shadow: 0 10px 24px rgba(0,0,0,.35);
    padding:22px;
  }
  h1,h2,h3{margin:0 0 10px}
  .muted{color:var(--muted)}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .nav{display:flex; gap:8px; margin:12px 0 6px}
  .btn{
    background:#162e4d;
    color:var(--text);
    border:1px solid rgba(255,255,255,.08);
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    transition:.2s;
    font-weight:600;
    font-size:14px;
  }
  .btn:hover{transform: translateY(-1px); border-color:rgba(17,183,255,.5)}
  .btn.brand{background:linear-gradient(90deg, var(--brand), var(--brand-2)); color:#031622; border:none}
  .btn.danger{background:linear-gradient(90deg, #ff6b6b, #ff7e8b); color:#2b0b12; border:none}
  .btn.ok{background:linear-gradient(90deg, #2ecc71, #6be78f); color:#062212; border:none}
  .badge{display:inline-block; padding:4px 10px; border-radius:999px; background:var(--chip); color:var(--chip-text); font-size:12px}
  .grid{display:grid; gap:14px}
  .grid-2{grid-template-columns:repeat(2, minmax(0,1fr))}
  .hidden{display:none !important}
  input, textarea, select{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.08);
    background:#0e2137; color:var(--text); outline:none;
  }
  label{font-size:13px; color:var(--muted)}
  .sectionTitle{margin:18px 0 8px; font-size:13px; color:var(--muted); text-transform:uppercase; letter-spacing:.08em}
  .list{background:#0f2238; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; white-space:pre-wrap}
  .center{display:flex; align-items:center; justify-content:center; min-height:60vh}
  .login-card{width:100%; max-width:520px}
  .success{color:var(--ok)}
  .danger-text{color:var(--danger)}
  .hr{height:1px; background:rgba(255,255,255,.06); margin:12px 0}
  .topbar{display:flex; align-items:center; justify-content:space-between; gap:10px}
  .titleRow{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .kicker{font-size:13px; color:var(--muted)}
  .quickRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
  .notice{font-size:13px; color:var(--muted)}
  @media (max-width:760px){ .grid-2{grid-template-columns: 1fr} }
</style>
</head>
<body>

<div class="container">

  <!-- LOGIN VIEW -->
  <div id="view-login" class="center">
    <div class="card login-card">
      <h2 style="margin-bottom:4px;">Login</h2>
      <div class="kicker">Username ‡§î‡§∞ Password ‡§≠‡§∞‡•ã (case-insensitive)‡•§</div>
      <div class="hr"></div>
      <div class="grid">
        <div>
          <label>Username</label>
          <input id="login-username" placeholder="e.g. Ritvik kem" autocomplete="username" />
        </div>
        <div>
          <label>Password</label>
          <input id="login-password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
        </div>
        <div class="row" style="justify-content:space-between; margin-top:6px">
          <button class="btn" id="btn-open-signup">Create Account</button>
          <button class="btn brand" id="btn-login">Login</button>
        </div>
        <div id="login-error" class="danger-text hidden">Invalid login!</div>
      </div>
    </div>
  </div>

  <!-- SIGNUP VIEW (NEW) -->
  <div id="view-signup" class="center hidden">
    <div class="card login-card">
      <h2 style="margin-bottom:4px;">Create Account</h2>
      <div class="kicker">‡§Ö‡§™‡§®‡§æ Name ‡§î‡§∞ Phone no. ‡§°‡§æ‡§≤‡•á‡§Ç ‚Üí OTP verify ‡§ï‡§∞‡•á‡§Ç ‚Üí Password ‡§Ü‡§™‡§ï‡•á ‡§´‡•ã‡§® ‡§™‡§∞ ‡§≠‡•á‡§ú ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§</div>
      <div class="hr"></div>
      <div class="grid">
        <div>
          <label>Full Name (Username)</label>
          <input id="su-name" placeholder="e.g. Shivam Sharma" />
        </div>
        <div>
          <label>Phone Number</label>
          <input id="su-phone" placeholder="e.g. 9876543210" inputmode="numeric" />
        </div>
        <div class="row" style="justify-content:flex-end">
          <button class="btn brand" id="btn-send-otp">Send Code</button>
        </div>
        <div>
          <label>Enter OTP</label>
          <input id="su-otp" placeholder="6-digit code" inputmode="numeric" />
        </div>
        <div class="row" style="justify-content:space-between">
          <button class="btn" id="btn-back-login">Back to Login</button>
          <button class="btn ok" id="btn-verify-create">Verify & Create</button>
        </div>
        <div id="su-error" class="danger-text hidden">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- APP VIEW -->
  <div id="view-app" class="hidden">
    <div class="card">
      <div class="topbar">
        <div>
          <div class="titleRow">
            <h2 id="welcome-title">Welcome</h2>
          </div>
          <div class="success" id="congrats-line">üéâ Congratulations, Welcome!</div>
          <div class="kicker" style="margin-top:6px;">Rank: <span id="rank-chip" class="badge">-</span></div>
          <div class="kicker" style="margin-top:6px;">Today: <span id="today"></span></div>
        </div>
        <div class="nav">
          <button class="btn" data-tab="home">Home</button>
          <button class="btn" data-tab="attendance">Attendance</button>
          <button class="btn" data-tab="complaint">Complaint</button>
          <button class="btn" data-tab="records">My Records</button>
          <button class="btn hidden" id="btn-admin" data-tab="admin">Admin Panel</button>
          <button class="btn" id="btn-logout">Logout</button>
        </div>
      </div>

      <div class="hr"></div>

      <!-- HOME TAB -->
      <div id="tab-home">
        <h3>Quick Actions</h3>
        <div class="quickRow">
          <button class="btn ok" id="btn-mark-att">Mark Attendance</button>
          <button class="btn brand" id="btn-open-complaint">Open Complaint Box</button>
        </div>
        <div class="notice" style="margin-top:10px">
          Attendance ‡§î‡§∞ Complaint ‡§á‡§∏ web version ‡§Æ‡•á‡§Ç <b>localStorage</b> ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡§π‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ Server ‡§≤‡§ó‡§®‡•á ‡§™‡§∞ Firestore add ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
        </div>
      </div>

      <!-- ATTENDANCE TAB -->
      <div id="tab-attendance" class="hidden">
        <h3>Attendance</h3>
        <div class="row" style="margin:10px 0">
          <button class="btn ok" id="btn-mark-att-2">Mark Attendance (Today)</button>
        </div>
        <div class="list" id="att-list">No records</div>
      </div>

      <!-- COMPLAINT TAB -->
      <div id="tab-complaint" class="hidden">
        <h3>Complaint Box</h3>
        <div class="grid">
          <div>
            <label>Write Complaint</label>
            <textarea id="complaint-text" rows="4" placeholder="Type here..."></textarea>
          </div>
          <div class="row" style="justify-content:flex-end">
            <button class="btn brand" id="btn-save-complaint">Submit Complaint</button>
          </div>
        </div>
        <div class="sectionTitle">My Complaints</div>
        <div class="list" id="complaint-list">No complaints</div>
      </div>

      <!-- RECORDS TAB -->
      <div id="tab-records" class="hidden">
        <h3>My Records</h3>
        <div class="grid grid-2">
          <div>
            <div class="sectionTitle">Attendance</div>
            <div class="list" id="rec-att">-</div>
          </div>
          <div>
            <div class="sectionTitle">Complaints</div>
            <div class="list" id="rec-comp">-</div>
          </div>
        </div>
      </div>

      <!-- ADMIN TAB (GOD + ZOD) -->
      <div id="tab-admin" class="hidden">
        <h3>Admin Panel (GOD + ZOD)</h3>
        <div class="sectionTitle">All Attendance + Complaints (raw)</div>
        <div class="list" id="admin-raw">-</div>

        <div class="sectionTitle">Ban / Temp Ban Users</div>
        <div class="grid grid-2">
          <div>
            <label>Username (exact)</label>
            <input id="ban-username" placeholder="e.g. Bhavya solanki" />
          </div>
          <div class="grid">
            <div class="row">
              <div style="flex:1">
                <label>Temp Ban (duration)</label>
                <input id="ban-duration" placeholder="e.g. 30m / 2h / 3d (optional)" />
              </div>
            </div>
            <div class="row" style="justify-content:flex-end">
              <button class="btn danger" id="btn-ban">Ban User</button>
              <button class="btn danger" id="btn-tempban">Temp Ban</button>
              <button class="btn ok" id="btn-unban">Unban</button>
            </div>
          </div>
        </div>

        <div class="sectionTitle">Current Bans</div>
        <div class="list" id="bans-list">None</div>

        <div class="sectionTitle">Grant Rank (ZOD only)</div>
        <div class="grid grid-2">
          <div>
            <label>Username</label>
            <input id="rank-user" placeholder="e.g. Simrit solanki" />
          </div>
          <div>
            <label>Rank</label>
            <select id="rank-value">
              <option value="HEAD">HEAD</option>
              <option value="GOD">GOD</option>
              <option value="ZOD">ZOD</option>
              <option value="GOLDEN" selected>GOLDEN</option>
            </select>
          </div>
          <div class="row" style="justify-content:flex-end">
            <button class="btn brand" id="btn-grant-rank">Grant Rank</button>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>

<script>
/* ===========================
   SETTINGS
=========================== */
const FORCE_LOGOUT_ON_REFRESH = false; // true ‡§ï‡§∞‡•ã‡§ó‡•á ‡§§‡•ã refresh ‡§™‡§∞ logout ‡§π‡•ã‡§ó‡§æ

/* ===========================
   DATA
=========================== */
const USERS = {
  "bhavya solanki": { name: "Bhavya solanki", pass: "1111111", rank: "HEAD" },
  "vrinda solanki": { name: "Vrinda solanki", pass: "8888888", rank: "GOD" },
  "ritvik kem":     { name: "Ritvik kem",     pass: "20250179751", rank: "ZOD" },
  "simrit solanki": { name: "Simrit solanki", pass: "2025", rank: "GOLDEN" },
};

// localStorage keys
const LS = {
  SESSION: "mma_session_v1",
  DATA: "mma_data_v1"
};

// App data in localStorage
function loadData(){
  const raw = localStorage.getItem(LS.DATA);
  if(!raw){
    const base = { attendance:{}, complaints:{}, bans:{} }; // bans: { "username-lower": {permanent:true} or {until:timestamp} }
    localStorage.setItem(LS.DATA, JSON.stringify(base));
    return base;
  }
  try{ return JSON.parse(raw) }catch{ localStorage.removeItem(LS.DATA); return loadData();}
}
function saveData(d){ localStorage.setItem(LS.DATA, JSON.stringify(d)); }

let DATA = loadData();

/* ===========================
   UTILS
=========================== */
const $ = sel => document.querySelector(sel);
const todayStr = () => new Date().toISOString().slice(0,10);
$("#today").textContent = todayStr();

function setView(idToShow){
  // hide all top-level views
  $("#view-login").classList.add("hidden");
  $("#view-app").classList.add("hidden");
  $("#view-signup").classList.add("hidden");
  document.querySelectorAll('[id^="tab-"]').forEach(n=>n.classList.add("hidden"));
  // show required
  if(idToShow.startsWith("tab-")){
    $("#view-app").classList.remove("hidden");
    $("#"+idToShow).classList.remove("hidden");
  }else{
    $("#"+idToShow).classList.remove("hidden");
  }
}

function showTab(name){
  document.querySelectorAll('[id^="tab-"]').forEach(n=>n.classList.add("hidden"));
  $("#tab-"+name).classList.remove("hidden");
}

function normalizeUser(u){ return (u||"").trim().toLowerCase(); }

function isAdminRank(rank){ return rank==="GOD" || rank==="ZOD"; }

/* ===========================
   SESSION
=========================== */
function getSession(){
  const raw = localStorage.getItem(LS.SESSION);
  if(!raw) return null;
  try{ return JSON.parse(raw) }catch{return null}
}
function setSession(session){
  if(session) localStorage.setItem(LS.SESSION, JSON.stringify(session));
  else localStorage.removeItem(LS.SESSION);
}

/* ===========================
   LOGIN
=========================== */
const loginBtn = $("#btn-login");
loginBtn.addEventListener("click", handleLogin);

// NEW: open signup
$("#btn-open-signup").addEventListener("click", ()=> setView("view-signup"));

function handleLogin(){
  const u = normalizeUser($("#login-username").value);
  const p = ($("#login-password").value||"").trim();

  const user = USERS[u];
  const err = $("#login-error");

  if(!user || user.pass !== p){
    err.classList.remove("hidden");
    err.textContent = "Invalid login!";
    return;
  }
  // ban checks
  if(isUserBanned(u)){
    err.classList.remove("hidden");
    const b = DATA.bans[u];
    if(b?.permanent) err.textContent = "This user is permanently banned.";
    else if(b?.until){
      const left = b.until - Date.now();
      const mins = Math.ceil(left/60000);
      err.textContent = `Temporarily banned. Try again in ~${mins} min.`;
    }else{
      err.textContent = "Banned user.";
    }
    return;
  }

  err.classList.add("hidden");
  setSession({ userKey: u, loggedAt: Date.now() });
  initAfterLogin();
}

function isUserBanned(userKey){
  const b = DATA.bans[userKey];
  if(!b) return false;
  // temp ban expire
  if(b.until){
    if(Date.now()>b.until){
      delete DATA.bans[userKey];
      saveData(DATA);
      return false;
    }
    return true;
  }
  // permanent
  return !!b.permanent;
}

function initAfterLogin(){
  const session = getSession();
  if(!session){ setView("view-login"); return; }

  const user = USERS[session.userKey];
  if(!user){ setSession(null); setView("view-login"); return; }

  // header bind
  $("#welcome-title").textContent = `Welcome, ${user.name}`;
  $("#rank-chip").textContent = user.rank;
  $("#congrats-line").textContent = `üéâ Congratulations, Welcome ${user.name}!`;

  // admin button
  $("#btn-admin").classList.toggle("hidden", !isAdminRank(user.rank));

  // fill lists
  refreshMyRecords();
  refreshAdminRaw();
  refreshBansUI();
  refreshAttendanceList();
  refreshComplaintsList();

  setView("tab-home");
}

/* ===========================
   LOGOUT (and refresh control)
=========================== */
$("#btn-logout").addEventListener("click", ()=>{ setSession(null); setView("view-login"); });

if(FORCE_LOGOUT_ON_REFRESH){
  // clear session on each load
  setSession(null);
}

window.addEventListener("DOMContentLoaded", ()=>{
  const s = getSession();
  if(s) initAfterLogin(); else setView("view-login");
});

/* ===========================
   NAV TABS
=========================== */
document.querySelectorAll('.nav .btn[data-tab]').forEach(b=>{
  b.addEventListener("click", ()=> showTab(b.dataset.tab));
});

/* ===========================
   ATTENDANCE
=========================== */
function markAttendance(){
  const s = getSession(); if(!s) return;
  const userKey = s.userKey;
  const t = todayStr();
  if(!DATA.attendance[userKey]) DATA.attendance[userKey] = [];
  if(!DATA.attendance[userKey].includes(t)){
    DATA.attendance[userKey].push(t);
    saveData(DATA);
  }
  refreshMyRecords();
  refreshAttendanceList();
  alert("Attendance marked for today ‚úîÔ∏è");
}
$("#btn-mark-att").addEventListener("click", markAttendance);
$("#btn-mark-att-2").addEventListener("click", markAttendance);

function refreshAttendanceList(){
  const s = getSession(); if(!s) return;
  const arr = (DATA.attendance[s.userKey]||[]).slice().sort();
  $("#att-list").textContent = arr.length ? arr.join("\n") : "No records";
}

/* ===========================
   COMPLAINTS
=========================== */
$("#btn-open-complaint").addEventListener("click", ()=> showTab("complaint"));
$("#btn-save-complaint").addEventListener("click", ()=>{
  const s = getSession(); if(!s) return;
  const text = ($("#complaint-text").value||"").trim();
  if(!text){ alert("Write something first!"); return; }
  if(!DATA.complaints[s.userKey]) DATA.complaints[s.userKey] = [];
  DATA.complaints[s.userKey].push({ text, at: new Date().toISOString() });
  saveData(DATA);
  $("#complaint-text").value = "";
  refreshComplaintsList();
  refreshMyRecords();
  alert("Complaint submitted ‚úÖ");
});

function refreshComplaintsList(){
  const s = getSession(); if(!s) return;
  const arr = (DATA.complaints[s.userKey]||[]);
  if(!arr.length){ $("#complaint-list").textContent = "No complaints"; return; }
  $("#complaint-list").textContent = arr.map(c=>`‚Ä¢ [${c.at.slice(0,16).replace('T',' ')}] ${c.text}`).join("\n");
}

/* ===========================
   RECORDS VIEW
=========================== */
function refreshMyRecords(){
  const s = getSession(); if(!s) return;
  const atts = (DATA.attendance[s.userKey]||[]).slice().sort();
  $("#rec-att").textContent = atts.length? atts.join("\n") : "-";
  const comps = (DATA.complaints[s.userKey]||[]);
  $("#rec-comp").textContent = comps.length? comps.map(c=>`[${c.at.slice(0,10)}] ${c.text}`).join("\n") : "-";
}

/* ===========================
   ADMIN PANEL
=========================== */
function refreshAdminRaw(){
  const s = getSession(); if(!s) return;
  const me = USERS[s.userKey];
  if(!isAdminRank(me.rank)) return;

  const dump = {
    users: Object.fromEntries(Object.entries(USERS).map(([k,v])=>[v.name,{password:v.pass, rank:v.rank}])),
    attendance: Object.fromEntries(Object.entries(DATA.attendance||{}).map(([k,v])=>[USERS[k]?.name||k, v])),
    complaints: Object.fromEntries(Object.entries(DATA.complaints||{}).map(([k,v])=>[USERS[k]?.name||k, v])),
    bans: DATA.bans
  };
  $("#admin-raw").textContent = JSON.stringify(dump, null, 2);
}

function parseDurationToMs(s){
  if(!s) return null;
  const m = String(s).trim().toLowerCase().match(/^(\d+)\s*(m|h|d)$/);
  if(!m) return null;
  const n = parseInt(m[1],10);
  const unit = m[2];
  if(unit==="m") return n*60*1000;
  if(unit==="h") return n*60*60*1000;
  if(unit==="d") return n*24*60*60*1000;
  return null;
}

function refreshBansUI(){
  const lines = [];
  const now = Date.now();
  for(const [key,info] of Object.entries(DATA.bans||{})){
    const name = USERS[key]?.name || key;
    if(info.permanent) lines.push(`üö´ ${name} ‚Äî PERMANENT`);
    else if(info.until){
      const leftMin = Math.max(0, Math.ceil((info.until-now)/60000));
      const untilStr = new Date(info.until).toLocaleString();
      lines.push(`‚è≥ ${name} ‚Äî Temp until ${untilStr} (~${leftMin} min)`);
    }
  }
  $("#bans-list").textContent = lines.length? lines.join("\n") : "None";
}

$("#btn-ban").addEventListener("click", ()=>{
  const s = getSession(); if(!s) return;
  const me = USERS[s.userKey];
  if(!isAdminRank(me.rank)){ alert("No admin rights."); return; }

  const u = normalizeUser($("#ban-username").value);
  if(!USERS[u]) return alert("User not found.");
  DATA.bans[u] = { permanent:true };
  saveData(DATA);
  refreshBansUI();
  alert(`Banned ${USERS[u].name}`);
});

$("#btn-tempban").addEventListener("click", ()=>{
  const s = getSession(); if(!s) return;
  const me = USERS[s.userKey];
  if(!isAdminRank(me.rank)){ alert("No admin rights."); return; }

  const u = normalizeUser($("#ban-username").value);
  const dur = parseDurationToMs($("#ban-duration").value);
  if(!USERS[u]) return alert("User not found.");
  if(!dur) return alert("Use duration like 30m / 2h / 1d");
  DATA.bans[u] = { until: Date.now()+dur };
  saveData(DATA);
  refreshBansUI();
  alert(`Temp banned ${USERS[u].name}`);
});

$("#btn-unban").addEventListener("click", ()=>{
  const s = getSession(); if(!s) return;
  const me = USERS[s.userKey];
  if(!isAdminRank(me.rank)){ alert("No admin rights."); return; }

  const u = normalizeUser($("#ban-username").value);
  if(!DATA.bans[u]) return alert("User is not banned.");
  delete DATA.bans[u];
  saveData(DATA);
  refreshBansUI();
  alert(`Unbanned ${USERS[u].name}`);
});

$("#btn-grant-rank").addEventListener("click", ()=>{
  const s = getSession(); if(!s) return;
  const me = USERS[s.userKey];
  if(me.rank!=="ZOD"){ alert("Only ZOD can grant rank."); return; }

  const u = normalizeUser($("#rank-user").value);
  const rv = $("#rank-value").value;
  if(!USERS[u]) return alert("User not found.");
  USERS[u].rank = rv;
  // UI update if changed self?
  if(u===s.userKey){
    $("#rank-chip").textContent = rv;
    $("#btn-admin").classList.toggle("hidden", !isAdminRank(rv));
  }
  refreshAdminRaw();
  alert(`Granted rank ${rv} to ${USERS[u].name}`);
});

/* ===========================
   SIGNUP / OTP (NEW)
=========================== */
const PENDING_OTP = {}; // { phone: { code, until } }

function genOTP(){
  return String(Math.floor(100000 + Math.random()*900000)); // 6-digit
}
function genPassword(){
  const random7 = String(Math.floor(Math.random()*1e7)).padStart(7,'0');
  return "2025" + random7;
}
function isPhoneValid(ph){
  const d = (ph||"").replace(/\D/g,"");
  return d.length>=8 && d.length<=15;
}
function userExistsByName(name){
  return !!USERS[normalizeUser(name)];
}

$("#btn-send-otp").addEventListener("click", ()=>{
  const name = ($("#su-name").value||"").trim();
  const phone = ($("#su-phone").value||"").trim();
  const err = $("#su-error");

  if(!name){ err.classList.remove("hidden"); err.textContent="Name required."; return; }
  if(userExistsByName(name)){ err.classList.remove("hidden"); err.textContent="This username already exists."; return; }
  if(!isPhoneValid(phone)){ err.classList.remove("hidden"); err.textContent="Enter a valid phone number."; return; }

  err.classList.add("hidden");
  const code = genOTP();
  const ttlMs = 5*60*1000; // 5 minutes
  PENDING_OTP[phone] = { code, until: Date.now()+ttlMs, name };
  // Simulate SMS
  alert(`üîê OTP sent to ${phone}: ${code}\n(Testing mode ‚Äì real SMS not configured)`);
});

$("#btn-verify-create").addEventListener("click", ()=>{
  const name = ($("#su-name").value||"").trim();
  const phone = ($("#su-phone").value||"").trim();
  const code = ($("#su-otp").value||"").trim();
  const err = $("#su-error");

  if(!name){ err.classList.remove("hidden"); err.textContent="Name required."; return; }
  if(userExistsByName(name)){ err.classList.remove("hidden"); err.textContent="This username already exists."; return; }
  if(!isPhoneValid(phone)){ err.classList.remove("hidden"); err.textContent="Enter a valid phone number."; return; }
  const pending = PENDING_OTP[phone];
  if(!pending){ err.classList.remove("hidden"); err.textContent="Please request OTP first."; return; }
  if(Date.now()>pending.until){ delete PENDING_OTP[phone]; err.classList.remove("hidden"); err.textContent="OTP expired. Send a new code."; return; }
  if(pending.name !== name){ err.classList.remove("hidden"); err.textContent="Name changed. Send OTP again."; return; }
  if(pending.code !== code){ err.classList.remove("hidden"); err.textContent="Invalid OTP."; return; }

  // OTP verified ‚Äî create account
  const pass = genPassword();
  const key = normalizeUser(name);
  USERS[key] = { name: name, pass: pass, rank: "GOLDEN" };
  delete PENDING_OTP[phone];

  // ‚ÄúSend‚Äù password via SMS (simulated)
  alert(`‚úÖ Account created for "${name}"\nüîë Password sent to ${phone}: ${pass}\n(Testing mode ‚Äì real SMS not configured)\n\nUse this Username & Password on Login.`);

  // Pre-fill login & switch
  $("#login-username").value = name;
  $("#login-password").value = pass;
  $("#su-name").value = "";
  $("#su-phone").value = "";
  $("#su-otp").value = "";
  err.classList.add("hidden");
  setView("view-login");
});

/* back to login */
$("#btn-back-login").addEventListener("click", ()=> setView("view-login"));

/* ===========================
   OPTIONAL: Firebase hook (not required for local)
   (‡§Ö‡§ó‡§∞ Firebase SDK use ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã, ‡§§‡•ã ‡§®‡•Ä‡§ö‡•á ‡§Ö‡§™‡§®‡§æ config ‡§°‡§æ‡§≤‡§ï‡§∞ enable ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•ã)
=========================== */
// // import { initializeApp } from "firebase/app";
// // import { getAnalytics } from "firebase/analytics";
// // const firebaseConfig = {
// //   apiKey: "AIzaSyDtLIQsijdswlGG6rpUH1vJFqt1O6OCqK8",
// //   authDomain: "mma-official.firebaseapp.com",
// //   projectId: "mma-official",
// //   storageBucket: "mma-official.firebasestorage.app",
// //   messagingSenderId: "1081156049161",
// //   appId: "1:1081156049161:web:bba5bdfd0cf0ebd39adbd8",
// //   measurementId: "G-MKQK414040"
// // };
// // const app = initializeApp(firebaseConfig);
// // const analytics = getAnalytics(app);

</script>
</body>
</html>